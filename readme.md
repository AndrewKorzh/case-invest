# Case

Файл в корневой папке проекта
`config.py:`

`db_config` = {   
    "dbname": "xxx",   
    "user": "xxx",     
    "password": "xxx",   
    "host": "xxx",   
    "port": "xxx",    
}

`ARCHIVE_PATH` = "xxx"

`STAGE_SCHEMA_NAME` = "xxx"

---

# Этапы  
Отдельный модуль для создания stage
- Нужен для первичной настройки - просто пустые таблички со связями
- Создаём ErrorTable - может несколько, с типами ошибок и тд
- Создаём Триггеры для всех таблиц (это для различных проверок)


Заполнение данными (цикл по всем табличкам, для каждой процесс идентичный)
- В data_structure получили пару ключ-значение - в ней необходимые данные о конкретной табличке
- Проходимся по всем файлам csv в папке (имя указано, путь к архиву черех config) и проверяем (только по первой строчке - быстрый процесс) наличие заголовков, соответствие ожидаемой структуре

| file_path | success | headers |
|----------------|----------------|----------------|
| ...file1.csv    | True     | True     |
| ...file2.csv     | True     | False     |
| ...file3.csv     | False     | False     |

- Создаём временную таблицу где все столбцы text (без индексов и тд) - она нужна для обработки

- Все успешные файлы через \copy в временную таблицу, неуспешные - записываем в служебную БД
 
- Далее производим вставку данных 

# Мысли всякие 
- Запуск некоторого метода который запускает процесс по всем табличкам (сначала очискта), все данные берёт из data_structure
- Последовательность имеет значение

# Реестр проверок
- PK - уникальные
- FK - присутствуют

# Очерёдность
- Создание всех таблиц
- 
# TODO
- Обернуть всё что можно в try exept
- Добавлять ошибки в какой-то logger